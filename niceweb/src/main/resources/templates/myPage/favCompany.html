<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지원본-미래</title>
    <script th:src="@{/js/lib/jquery-3.7.1.min.js}"></script>
    <!--부트스트랩5버전-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!--~~~공통 css적용을 위한 리소스-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>태수마이페이지</title>
    <link rel="icon" th:href="@{/images/common/favi.png}">
    <meta property="og:title" content="나이스투매치유">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image" content="http://ilmobility.co.kr/@resource/images/common/sns_share.png">
    <!-- 페이지가 소셜 미디어 플랫폼에 공유될 때 표시될 이미지의 URL을 지정 -->
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="400">
    <link type="text/css" rel="stylesheet" th:href="@{/css/inquirymodal.css}">
    <!-- <link type="text/css" rel="stylesheet" th:href="@{/css/nice_dev.css}"> 이거 하면 모달창이나 부트스트랩 버튼이 안먹음 -->
    <script th:src="@{/js/nice_dev.js}"></script>
    <!--여기까지~~~~-->



    <!--우선은 테이블 부분 css를 직접 적용한 페이지-->


    <script>
        $(function () {
            init();

        });
        function init() {
            let userNum = $("#userNum").val();// 로그인한 사람의 고유번호(시퀀스)

            $.ajax({
                url: "/user/favCmpAll"
                , method: 'GET'
                , data: { "userNum": userNum }
                , success: output
            })

        }// init-end
        function output(resp) {

            let receivedData = `
                    <tr>
                        <th>기업명</th>
                        <th>던스넘버</th>
                        <th>홈페이지</th>
                        <th>이메일</th>
                        <th>자세히 보기</th>
                        <th>찜기능</th>
                    </tr>`;
            let favCount = 0; // 총 갯수가 몇개인지 count
            $.each(resp, function (index, item) {
                favCount += 1;
                receivedData += `
                        <tr>
                            <td>${item.cmpName}</td>
                            <td>${item.cmpDunsNo}</td>
                            <td>${item.cmpUrl}</td>
                            <td>${item.cmpEmail}</td>
                            <td><input type="button"  class="btn btn-primary" attr-dunsNo=${item.cmpDunsNo} value="상세보기"></td>
                            <td><input type="button"  class="delBtn btn btn-warning" style="color: white;" attr-favCmpNo=${item.favCmpNo} value="찜기능"></td>`
                    ;// 찜기능은 삭제 버튼이다.
                // 각각의 버튼에 이벤트 걸어주기 
                receivedData += `</tr>`;
            });//each 
            $("#favoriteList").html(receivedData);
            $("#board-count").html(favCount);
            $(".delBtn").on('click', deleteCmp);// html로 모두 생성된 이후에 이벤트를 걸어야함 
        }// output 함수 종료부분

        // 삭제 함수 - 데이터 베이스에서 삭제함 
        function deleteCmp() {
            if (confirm("삭제하시겠습니까?")) {
                let favCmpNo = $(this).attr("attr-favCmpNo");// 클릭한 것의 고유 넘버 
                let favCount = $("#board-count").text(); // 총 몇개인지 건수
                favCount -= 1;
                $.ajax({
                    url: "/user/favCmpDelete"
                    , method: 'GET'
                    , data: { "favCmpNo": favCmpNo }
                    , success: function (deledata) {

                    }
                })
                let data = $(this).parent().parent();// 화면에서 tr객체 삭제 
                data.remove();
                $("#board-count").html(favCount);

            }
        }
    </script>

</head>

<body>
    <div class="logo">
        <a style="font-size: 30px;">NICE TO MATCH YOU</a> <!-- 우선은 폰트 크기를 직접 지정함-->
    </div>

    <div class="gnb">
        <ul class="menubar"> <!-- 메뉴들 상단 중앙-->
            <li>메뉴1</li>
            <li>메뉴2</li>
            <li>메뉴3</li>
            <li>메뉴4</li>
            <li>메뉴5</li>
        </ul>
    </div>
    <!--로그인한 회원의 정보 끌어오기(아직 미정이긴 함)-->
    <section>
        <div>
            <span>회사이름</span> <!--회사 이름 들어갈꺼-->
            <strong>
                <b>담당자 이름</b> <!-- 담당자 이름-->
            </strong>
        </div>
    </section>

    <!--찜한 회사 정보 출력-->
    <h3>관심 바이어</h3>
    <div class="content">
        <!-- <input type="hidden" id="loginId" th:value="${#authentication.name}"> 로그인한 유저의 -->
        <input type="hidden" id="userNum" value="1"><!--우선은 임으로 만들어봄 -->

        <!--찜 기능 리스트-->
        <div>
            <span>총 </span><span id="board-count"></span><span>건</span>
        </div>
        <!--데이터가 꽂히는 부분-->
        <table id="favoriteList">
        </table>


    </div>
</body>

</html>