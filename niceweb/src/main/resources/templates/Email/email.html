<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보낸 메일함</title>
    <!--부트스트랩5버전: 버튼과 모달창에 사용-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/script/jquery-3.7.1.min.js}"></script>
    <script>
        $(function () {
            init(); // 보낸 메일 전체 출력 

        });
        function init() {
            let userNum = $("#userNum").val();// 로그인한 사람의 고유번호(시퀀스)

            $.ajax({
                url: "/mail/mailList"
                , method: 'GET'
                , data: { "userNum": userNum }
                , success: output
            })
        }// init-end

        function output(item) {
            let receivedData = `
                    <tr>
                        <th>받는사람</th>
                        <th>제목</th>
                        <th>보낸 날짜</th>
                        <th>삭제</th>
                    </tr>`;
            $.each(item, function (index, item) {

                receivedData += `
                        <tr>
                            <td>${item.receiver}</td>
                            <td><a data-bs-target="#myModal" data-bs-toggle="modal">${item.emailSubject}</a></td>
                            <td>${item.sendedDate}</td>
                            <td><input type="button"  class="delBtn btn btn-warning" style="color: white;" attr-favCmpNo=${item.emailNum} value="삭제"></td>`
                    ;
                receivedData += `</tr>`;
            });//each

            $("#sendedEmail-list").html(receivedData);
        }


    </script>

</head>

<body>
    <h2>보낸 메일함</h2>
    <!-- 로그인 유저의 고유 넘버값 넣어주는거 있지말기-->
    <!-- <input type="hidden" id="loginId" th:value="${#authentication.name}"> 로그인한 유저의 -->
    <input type="hidden" id="userNum" value="1"><!--우선은 임으로 만들어봄 -->
    <span id="noResult"></span><!--보낸 메일함이 적을때 출력합니다.
    -->
    <table id="sendedEmail-list"> <!--보낸 편지 출력-->
    </table>

    <!--보낸편지 모달창으로 띄우기-->
    <!-- 이메일 모달창 부분 -->
    <div class="modal" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">보낸 메일</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">

                    <input id="cmpaddress" class="form-control" value="">
                    <br>
                    <input name="emailSubject" class="form-control"> <br>
                    <textarea name="emailContent" cols="60" rows="20" class="form-control"></textarea>
                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>
                </form>

            </div>
        </div>
    </div> <!--이메일 모달창 끝-->


</body>

</html>