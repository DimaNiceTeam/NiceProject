<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>규제</title>
</head>
<!--<script th:src="@{/script/Static.js}"></script>-->

<body>
    <h2>CSS 제외한 규제 페이지입니다</h2>
    <div id="insertReg">

    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const params = new URLSearchParams(window.location.search);
            const country = params.get('country');

            if (!country) {
                document.getElementById('insertReg').innerHTML = 'No country specified.';
                return;
            }

            fetch('/file/STAT_REG.csv')
                .then(response => response.text())
                .then(csvString => {
                    const parsedData = parseCSV(csvString);
                    const filteredData = filterByCountry(parsedData, country);
                    const tableHTML = convertToTableHTML(filteredData);
                    document.getElementById('insertReg').innerHTML = tableHTML;
                })
                .catch(error => {
                    console.error('Failed to load CSV file:', error);
                    document.getElementById('insertReg').innerHTML = 'Error loading data.';
                });
        });

        function parseCSV(csvString) {
            const rows = csvString.split('\n').filter(row => row.trim() !== '');
            return rows.map(row => {
                let inQuotes = false;
                let modifiedRow = '';
                for (let char of row) {
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    }
                    if (char === ',' && inQuotes) {
                        modifiedRow += '|'; // 일시적인 대체 문자
                    } else {
                        modifiedRow += char;
                    }
                }
                return modifiedRow.split(',').map(value => value.replace(/\|/g, ',').trim().replace(/"/g, ''));
            });
        }

        function filterByCountry(data, country) {
            return data.filter(row => row[0].toLowerCase() === country.toLowerCase());
        }

        function convertToTableHTML(data) {
            if (data.length === 0) {
                return 'No data found for selected country.';
            }
            let table = '<table border="1">';
            data.forEach((row, index) => {
                table += '<tr>';
                row.forEach(cell => {
                    table += `<td>${cell}</td>`;
                });
                table += '</tr>';
            });
            table += '</table>';
            return table;
        }
    </script>
</body>

</html>